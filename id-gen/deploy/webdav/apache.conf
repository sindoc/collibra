# Apache mod_dav config — id-gen WebDAV inbox
# Include in httpd.conf or drop in /etc/apache2/sites-enabled/
#
# Requires: mod_dav mod_dav_fs mod_auth_basic (or mod_authn_core for anonymous)
# Enable:   a2enmod dav dav_fs

<VirtualHost *:8080>
    ServerName id-gen.local

    # ── WebDAV inbox root ─────────────────────────────────────────────────────
    DocumentRoot /var/webdav/id-gen/inbox
    <Directory /var/webdav/id-gen/inbox>
        Options Indexes
        DAV On
        AuthType None
        Require all granted
        # For SSH-key-authenticated deployments, restrict to local subnet:
        # Require ip 192.168.0.0/16 10.0.0.0/8
    </Directory>

    # ── WebDAV sub-paths mirror inbox sub-dirs ─────────────────────────────────
    Alias /webdav/sparql   /var/webdav/id-gen/inbox/sparql
    Alias /webdav/contract /var/webdav/id-gen/inbox/contract
    Alias /webdav/conv     /var/webdav/id-gen/inbox/conv
    Alias /webdav/certs    /var/webdav/id-gen/inbox/certs

    <Location /webdav>
        DAV On
        Require all granted
    </Location>

    # ── id-gen API proxy ──────────────────────────────────────────────────────
    ProxyPass        /api/ http://localhost:7331/
    ProxyPassReverse /api/ http://localhost:7331/

    # ── UI static files ───────────────────────────────────────────────────────
    Alias /ui /opt/id-gen/ui
    <Directory /opt/id-gen/ui>
        Options -Indexes
        Require all granted
    </Directory>

    ErrorLog  /var/log/apache2/id-gen-error.log
    CustomLog /var/log/apache2/id-gen-access.log combined
</VirtualHost>
