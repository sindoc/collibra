# Define base directory and files
BASE_DIR := ..
CSRF_TOKEN_FILE := $(BASE_DIR)/X-CSRF-TOKEN
JSESSIONID_FILE := $(BASE_DIR)/JSESSIONID
COLLIBRA_BASE_URL_FILE := $(BASE_DIR)/CollibraBaseUrl
REST_PATH_FILE := ./RestPath

# Dynamically read configuration values
CSRF_TOKEN := $(shell cat $(CSRF_TOKEN_FILE) | head -1 )
JSESSIONID := $(shell cat $(JSESSIONID_FILE) | head -1 )
COLLIBRA_BASE_URL := $(shell cat $(COLLIBRA_BASE_URL_FILE))
REST_PATH := $(shell cat $(REST_PATH_FILE))
FULL_URL := $(COLLIBRA_BASE_URL)$(REST_PATH)

# JSON Payload dynamically generated by the script
JSON_PAYLOAD := $(shell ./generate_payload.sh)

# Targets
.PHONY: createAssets getCollibraBaseUrl getRestPath getAssets

# Run the curl command
createAssets:
	curl -X 'POST' \
    '$(FULL_URL)' \
    -H 'accept: application/json' \
    -H 'Content-Type: application/json' \
    -H 'X-CSRF-TOKEN: $(CSRF_TOKEN)' \
    --cookie 'JSESSIONID=$(JSESSIONID); XSRF-TOKEN=$(CSRF_TOKEN)' \
    -d '$(JSON_PAYLOAD)'

# Utility targets
getCollibraBaseUrl:
	@echo $(COLLIBRA_BASE_URL)

getRestPath:
	@echo $(REST_PATH)

